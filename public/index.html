<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Anglican Streaming Graphics Suite (LAN)</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            darkMode: 'class',
        }
    </script>
    <script>
        // On page load or when changing themes, best to add inline in `head` to avoid FOUC
        function initTheme() {
            if (localStorage.theme === 'dark' || (!('theme' in localStorage) && window.matchMedia('(prefers-color-scheme: dark)').matches)) {
                document.documentElement.classList.add('dark');
            } else {
                document.documentElement.classList.remove('dark');
            }
        }
        initTheme();
    </script>
    <script src="/socket.io/socket.io.js"></script> <!-- Auto-served by Node -->
    <link
        href="https://fonts.googleapis.com/css2?family=Cinzel:wght@400;700;900&family=Lato:wght@300;400;700&family=Montserrat:wght@300;400;700&family=Open+Sans:wght@300;400;700&family=Playfair+Display:wght@400;700&family=Roboto:wght@300;400;700&family=Share+Tech+Mono&display=swap"
        rel="stylesheet">
    <link rel="stylesheet" href="css/styles.css">
</head>

<body class="bg-slate-100 dark:bg-slate-900 text-slate-800 dark:text-slate-100">

    <!-- ================= DASHBOARD ================= -->
    <div id="dashboard" class="min-h-screen p-6">
        <div class="max-w-7xl mx-auto grid grid-cols-12 gap-6">
            <!-- Header -->
            <!-- Header -->
            <div class="col-span-12 flex flex-col md:flex-row gap-4">
                <!-- Title Box -->
                <div
                    class="flex-1 bg-white dark:bg-slate-800 p-4 rounded-xl shadow-sm border border-slate-200 dark:border-slate-700 flex flex-col justify-center">
                    <h1 class="text-2xl font-bold text-slate-800 dark:text-slate-100">Anglican Stream Graphics Suite
                    </h1>
                    <p class="text-xs text-slate-500 uppercase font-bold">Local Network Controller</p>
                </div>

                <!-- Controls Box -->
                <div
                    class="bg-white dark:bg-slate-800 p-3 rounded-xl shadow-sm border border-slate-200 dark:border-slate-700 flex items-center justify-end gap-3 flex-wrap">
                    <!-- Clock -->
                    <div class="flex items-center gap-2 bg-black/10 dark:bg-white/10 px-3 py-1 rounded-lg mr-2">
                        <span id="dashboard-clock" class="text-red-600 font-bold"
                            style="font-family: 'Share Tech Mono', monospace; font-size: 24px; line-height: 1;">00:00:00</span>
                        <div class="flex flex-col gap-0.5 ml-1">
                            <button onclick="adjClockSize(2)"
                                class="text-[8px] bg-slate-300 hover:bg-slate-400 dark:bg-slate-600 dark:hover:bg-slate-500 w-4 h-3 flex items-center justify-center rounded leading-none text-slate-800 dark:text-white">▲</button>
                            <button onclick="adjClockSize(-2)"
                                class="text-[8px] bg-slate-300 hover:bg-slate-400 dark:bg-slate-600 dark:hover:bg-slate-500 w-4 h-3 flex items-center justify-center rounded leading-none text-slate-800 dark:text-white">▼</button>
                        </div>
                    </div>

                    <!-- Theme -->
                    <select id="theme-selector" onchange="setTheme(this.value)"
                        class="px-2 py-1.5 border rounded font-bold text-sm bg-slate-50 dark:bg-slate-700 dark:border-slate-600 dark:text-white">
                        <option value="system">System</option>
                        <option value="light">Light</option>
                        <option value="dark">Dark</option>
                    </select>

                    <!-- Safe Toggle -->
                    <label
                        class="flex items-center gap-2 cursor-pointer bg-slate-100 dark:bg-slate-700 px-3 py-1.5 rounded border border-slate-200 dark:border-slate-600">
                        <input type="checkbox" onchange="toggleSafeGuides(this.checked)"
                            class="accent-blue-600 w-4 h-4">
                        <span class="text-xs font-bold font-mono">SAFE</span>
                    </label>

                    <!-- Status -->
                    <div id="auth-status"
                        class="px-3 py-1.5 bg-yellow-100 text-yellow-800 rounded text-xs font-bold flex items-center">
                        Connecting...</div>

                    <!-- Tools -->
                    <button onclick="copyLink()"
                        class="px-4 py-1.5 bg-slate-200 hover:bg-slate-300 dark:bg-slate-700 dark:hover:bg-slate-600 rounded font-bold text-sm">Copy
                        Link</button>
                    <button onclick="launchOverlay()"
                        class="px-4 py-1.5 bg-blue-900 text-white rounded font-bold text-sm shadow hover:bg-blue-800">Launch
                        Overlay</button>
                </div>
            </div>

            <!-- Left: Controls -->
            <div class="col-span-12 lg:col-span-4 space-y-6">
                <!-- Lower Third -->
                <div id="lt-section"
                    class="bg-white dark:bg-slate-800 p-5 rounded-xl shadow-sm border border-slate-200 dark:border-slate-700">
                    <div class="flex justify-between items-center mb-4">
                        <h2 class="text-lg font-bold text-blue-900 dark:text-blue-300">Lower Third</h2>
                        <div class="flex gap-2">
                            <a href="/designer.html" target="_blank"
                                class="text-xs bg-purple-100 dark:bg-purple-900 text-purple-600 dark:text-purple-200 px-2 py-1 rounded font-bold">Designer</a>
                            <button onclick="openListsModal()"
                                class="text-xs text-blue-600 dark:text-blue-400 font-bold underline">Manage
                                Lists</button>
                        </div>
                    </div>
                    <div class="space-y-4">
                        <select id="sel-person"
                            class="w-full p-2 border rounded bg-slate-50 dark:bg-slate-700 dark:border-slate-600 dark:text-white"></select>
                        <select id="sel-task"
                            class="w-full p-2 border rounded bg-slate-50 dark:bg-slate-700 dark:border-slate-600 dark:text-white"></select>
                        <div
                            class="flex items-center justify-between bg-slate-50 dark:bg-slate-700 p-2 rounded border dark:border-slate-600">
                            <div class="flex gap-3">
                                <label
                                    class="flex items-center gap-1 text-xs font-bold text-slate-600 dark:text-slate-300 cursor-pointer">
                                    <input type="radio" name="lt-mode" value="forever" onchange="toggleLtMode()">
                                    Forever
                                </label>
                                <label
                                    class="flex items-center gap-1 text-xs font-bold text-slate-600 dark:text-slate-300 cursor-pointer">
                                    <input type="radio" name="lt-mode" value="timeout" checked
                                        onchange="toggleLtMode()">
                                    Timeout
                                </label>
                            </div>
                            <input id="inp-lt-timeout" type="number"
                                class="w-16 border rounded p-1 text-xs text-center dark:bg-slate-600 dark:border-slate-500"
                                value="10">
                        </div>
                        <button id="btn-toggle-lt" onclick="toggleLowerThird()"
                            class="w-full bg-blue-900 text-white py-3 rounded font-bold">SHOW LOWER THIRD</button>
                    </div>
                </div>

                <!-- Timer -->
                <div id="timer-section"
                    class="bg-white dark:bg-slate-800 p-5 rounded-xl shadow-sm border border-slate-200 dark:border-slate-700">
                    <h2 class="text-lg font-bold text-blue-900 dark:text-blue-300 mb-4">Timer</h2>
                    <div class="space-y-4">
                        <div class="flex gap-2">
                            <input type="time" id="inp-target-time" value="09:30"
                                class="flex-1 p-2 border rounded font-mono dark:bg-slate-700 dark:border-slate-600 dark:text-white">
                            <button onclick="setCountdown()"
                                class="bg-blue-100 dark:bg-blue-900 text-blue-800 dark:text-blue-100 px-3 rounded font-bold text-xs">SET</button>
                        </div>

                        <!-- Style Controls -->
                        <details
                            class="group bg-slate-50 dark:bg-slate-700 rounded border border-slate-200 dark:border-slate-600">
                            <summary
                                class="p-2 cursor-pointer text-xs font-bold text-slate-500 dark:text-slate-400 select-none flex justify-between items-center bg-slate-100 dark:bg-slate-900 group-open:bg-slate-200 dark:group-open:bg-slate-800 transition-colors">
                                <span>APPEARANCE</span>
                                <span class="transform group-open:rotate-180 transition-transform">▼</span>
                            </summary>
                            <div class="p-3 space-y-3">
                                <div>
                                    <label class="block text-[10px] font-bold text-slate-400 mb-1">FONT</label>
                                    <select id="timer-font" onchange="updateTimerStyle()"
                                        class="w-full text-xs p-1 border rounded dark:bg-slate-600 dark:border-slate-500 dark:text-white">
                                        <option value="">Default (Lato)</option>
                                        <option value="'Cinzel', serif">Cinzel</option>
                                        <option value="'Montserrat', sans-serif">Montserrat</option>
                                        <option value="'Open Sans', sans-serif">Open Sans</option>
                                        <option value="'Playfair Display', serif">Playfair Display</option>
                                        <option value="'Roboto', sans-serif">Roboto</option>
                                    </select>
                                </div>
                                <div class="grid grid-cols-2 gap-2">
                                    <div>
                                        <label class="block text-[10px] font-bold text-slate-400 mb-1">TEXT
                                            COLOR</label>
                                        <div class="flex gap-1 items-center">
                                            <input type="color" id="timer-text-color" value="#ffffff"
                                                onchange="syncColorInput(this, 'timer-text-hex'); updateTimerStyle()"
                                                class="h-6 w-8 p-0 border-0 rounded cursor-pointer">
                                            <input type="text" id="timer-text-hex" value="#ffffff"
                                                onchange="syncColorPicker(this, 'timer-text-color'); updateTimerStyle()"
                                                class="w-16 text-xs p-1 border rounded font-mono dark:bg-slate-600 dark:border-slate-500 dark:text-white">
                                            <input type="number" id="timer-text-opacity" value="0.8" step="0.1" min="0"
                                                max="1" onchange="updateTimerStyle()"
                                                class="w-12 text-xs p-1 border rounded dark:bg-slate-600 dark:border-slate-500 dark:text-white text-center"
                                                placeholder="Op" title="Opacity">
                                        </div>
                                    </div>
                                    <div>
                                        <label class="block text-[10px] font-bold text-slate-400 mb-1">BG COLOR</label>
                                        <div class="flex gap-1 items-center">
                                            <input type="color" id="timer-bg-color" value="#000000"
                                                onchange="syncColorInput(this, 'timer-bg-hex'); updateTimerStyle()"
                                                class="h-6 w-8 p-0 border-0 rounded cursor-pointer">
                                            <input type="text" id="timer-bg-hex" value="#000000"
                                                onchange="syncColorPicker(this, 'timer-bg-color'); updateTimerStyle()"
                                                class="w-16 text-xs p-1 border rounded font-mono dark:bg-slate-600 dark:border-slate-500 dark:text-white">
                                            <input type="number" id="timer-bg-opacity" value="0.4" step="0.1" min="0"
                                                max="1" onchange="updateTimerStyle()"
                                                class="w-12 text-xs p-1 border rounded dark:bg-slate-600 dark:border-slate-500 dark:text-white text-center"
                                                placeholder="Op" title="Opacity">
                                        </div>
                                    </div>
                                    <div
                                        class="col-span-2 grid grid-cols-2 gap-2 mt-2 pt-2 border-t border-slate-200 dark:border-slate-600">
                                        <div>
                                            <label class="block text-[10px] font-bold text-slate-400 mb-1">X OFFSET
                                                (%)</label>
                                            <input type="number" id="timer-x" value="2" step="0.5"
                                                onchange="updateTimerStyle()"
                                                class="w-full text-xs p-1 border rounded dark:bg-slate-600 dark:border-slate-500 dark:text-white">
                                        </div>
                                        <div>
                                            <label class="block text-[10px] font-bold text-slate-400 mb-1">Y OFFSET
                                                (%)</label>
                                            <input type="number" id="timer-y" value="4" step="0.5"
                                                onchange="updateTimerStyle()"
                                                class="w-full text-xs p-1 border rounded dark:bg-slate-600 dark:border-slate-500 dark:text-white">
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </details>
                        <button id="btn-toggle-msg" onclick="toggleStartMessage()"
                            class="w-full bg-blue-100 dark:bg-blue-900 text-blue-900 dark:text-blue-100 py-2 rounded font-bold mb-2">SHOW
                            START
                            MESSAGE</button>
                        <button id="btn-toggle-timer" onclick="toggleTimer()"
                            class="w-full bg-blue-900 text-white py-3 rounded font-bold">SHOW TIMER</button>
                    </div>
                </div>
            </div>

            <!-- Right: Settings and Slates -->
            <div class="col-span-12 lg:col-span-8 space-y-6">
                <!-- Transition Settings -->


                <!-- Full Screen Slates -->
                <div
                    class="bg-white dark:bg-slate-800 p-5 rounded-xl shadow-sm border border-slate-200 dark:border-slate-700 h-full">
                    <div class="flex justify-between items-center mb-6">
                        <h2 class="text-lg font-bold text-blue-900 dark:text-blue-300">Full Screen Slates</h2>
                        <div class="flex gap-2">
                            <button onclick="openAddSlateModal()"
                                class="text-xs bg-blue-100 dark:bg-blue-900 text-blue-600 dark:text-blue-200 px-3 py-1 rounded font-bold">+
                                Add
                                Slate</button>
                            <button onclick="emitStatus({slate_active: false})"
                                class="text-xs bg-red-100 dark:bg-red-900 text-red-600 dark:text-red-200 px-3 py-1 rounded font-bold">Clear
                                Screen</button>
                        </div>
                    </div>
                    <div id="slates-grid" class="grid grid-cols-2 md:grid-cols-3 gap-4"></div>
                </div>
            </div>
        </div>
    </div>

    <!-- ================= OVERLAY ================= -->
    <div id="overlay" class="overlay-container">
        <!-- Slate -->
        <!-- Slate Wrapper for Cross-fading -->
        <div id="slate-wrapper" class="absolute inset-0 pointer-events-none">
            <!-- Buffer 1 -->
            <div id="slate-1" class="slate-container slate-default" style="z-index: 1;">
                <img class="slate-img-fs hidden" src="">
                <div class="slate-content-wrapper hidden">
                    <h1 class="slate-title serif-font"></h1>
                    <h2 class="slate-subtitle"></h2>
                </div>
            </div>
            <!-- Buffer 2 -->
            <div id="slate-2" class="slate-container slate-default" style="z-index: 1;">
                <img class="slate-img-fs hidden" src="">
                <div class="slate-content-wrapper hidden">
                    <h1 class="slate-title serif-font"></h1>
                    <h2 class="slate-subtitle"></h2>
                </div>
            </div>
        </div>
        <!-- Clock -->
        <div id="comp-clock" class="clock-container">
            <div id="el-clock" class="time-display">10:00:00 AM</div>
            <div id="el-start-message" class="time-display hidden">Service starts at 09:30</div>
        </div>
        <!-- Lower Third -->
        <div id="comp-lt" class="lt-bar-container">
            <div id="el-name" class="lt-name"></div>
            <div id="el-role" class="lt-role"></div>
        </div>
        <button onclick="toggleFS()"
            class="absolute top-4 left-4 bg-white/10 hover:bg-white/30 text-white px-4 py-2 rounded transition opacity-0 hover:opacity-100 pointer-events-auto">Full
            Screen</button>
        <div id="safe-guides" class="safe-area-overlay">
            <div class="safe-action"></div>
            <div class="safe-title"></div>
            <div class="safe-crosshair"></div>
            <div class="safe-crosshair vert"></div>
        </div>
    </div>

    <!-- ================= MODALS ================= -->
    <!-- Lists Modal -->
    <div id="modal-lists" class="modal hidden">
        <div class="bg-white dark:bg-slate-800 dark:text-slate-100 rounded-xl shadow-2xl p-6 w-full max-w-2xl m-4">
            <h3 class="text-xl font-bold mb-4 font-serif text-blue-900 dark:text-blue-300">Manage Lists</h3>
            <div class="grid grid-cols-2 gap-6 h-64">
                <div class="flex flex-col h-full">
                    <div class="flex justify-between items-center mb-2">
                        <h4 class="text-xs font-bold uppercase">People</h4>
                        <button onclick="triggerCsv('people')"
                            class="text-[10px] bg-slate-200 dark:bg-slate-600 hover:bg-slate-300 dark:hover:bg-slate-500 px-2 py-0.5 rounded text-slate-600 dark:text-slate-200 font-bold transition-colors">Import
                            CSV</button>
                        <input type="file" id="csv-people" class="hidden" accept=".csv"
                            onchange="processCsvUpload('people', this)">
                    </div>
                    <ul id="list-people"
                        class="flex-1 overflow-y-auto border rounded p-2 text-sm bg-slate-50 dark:bg-slate-700 dark:border-slate-600 space-y-1 mb-2">
                    </ul>
                    <div class="flex gap-2"><input id="new-person" placeholder="Name"
                            class="flex-1 border p-2 rounded text-sm dark:bg-slate-700 dark:border-slate-600"><button
                            onclick="addItem('people')" class="bg-blue-600 text-white px-3 rounded font-bold">+</button>
                    </div>
                </div>
                <div class="flex flex-col h-full">
                    <div class="flex justify-between items-center mb-2">
                        <h4 class="text-xs font-bold uppercase">Tasks</h4>
                        <button onclick="triggerCsv('tasks')"
                            class="text-[10px] bg-slate-200 dark:bg-slate-600 hover:bg-slate-300 dark:hover:bg-slate-500 px-2 py-0.5 rounded text-slate-600 dark:text-slate-200 font-bold transition-colors">Import
                            CSV</button>
                        <input type="file" id="csv-tasks" class="hidden" accept=".csv"
                            onchange="processCsvUpload('tasks', this)">
                    </div>
                    <ul id="list-tasks"
                        class="flex-1 overflow-y-auto border rounded p-2 text-sm bg-slate-50 dark:bg-slate-700 dark:border-slate-600 space-y-1 mb-2">
                    </ul>
                    <div class="flex gap-2"><input id="new-task" placeholder="Task"
                            class="flex-1 border p-2 rounded text-sm dark:bg-slate-700 dark:border-slate-600"><button
                            onclick="addItem('tasks')" class="bg-blue-600 text-white px-3 rounded font-bold">+</button>
                    </div>
                </div>
            </div>
            <div class="mt-6 flex justify-end"><button onclick="closeModal('modal-lists')"
                    class="bg-slate-200 dark:bg-slate-600 dark:text-white px-6 py-2 rounded font-bold">Done</button>
            </div>
        </div>
    </div>

    <!-- Add Slate Modal -->
    <div id="modal-add-slate" class="modal hidden">
        <div class="bg-white dark:bg-slate-800 dark:text-slate-100 rounded-xl shadow-2xl p-6 w-full max-w-md m-4">
            <h3 class="text-xl font-bold mb-4 font-serif text-blue-900 dark:text-blue-300">Add New Slate</h3>
            <div class="mb-4 flex gap-4">
                <label class="flex items-center gap-2"><input type="radio" name="stype" value="text" checked
                        onchange="toggleSlateInputs()"> <b>Text</b></label>
                <label class="flex items-center gap-2"><input type="radio" name="stype" value="image"
                        onchange="toggleSlateInputs()"> <b>Image</b></label>
            </div>
            <div id="inputs-text">
                <input id="new-stitle" class="w-full border p-2 rounded mb-2 dark:bg-slate-700 dark:border-slate-600"
                    placeholder="Title">
                <input id="new-ssub" class="w-full border p-2 rounded dark:bg-slate-700 dark:border-slate-600"
                    placeholder="Subtitle">
            </div>
            <div id="inputs-image" class="hidden">
                <input type="file" id="new-sfile" accept="image/*"
                    class="w-full border p-2 rounded mb-2 dark:bg-slate-700 dark:border-slate-600">
                <input id="new-slabel" class="w-full border p-2 rounded dark:bg-slate-700 dark:border-slate-600"
                    placeholder="Label (e.g. Poster)">
            </div>
            <div class="mt-6 flex justify-end gap-2">
                <button onclick="closeModal('modal-add-slate')"
                    class="bg-slate-200 dark:bg-slate-600 dark:text-white px-4 py-2 rounded font-bold">Cancel</button>
                <button onclick="saveNewSlate()"
                    class="bg-blue-600 text-white px-6 py-2 rounded font-bold">Save</button>
            </div>
        </div>
    </div>

    <!-- ================= LOGIC ================= -->
    <script src="js/main.js"></script>
    <script src="js/overlay.js"></script>
    <script src="js/dashboard.js"></script>
    <script src="js/socket.js"></script>
    <script src="js/utils.js"></script>
</body>

</html>